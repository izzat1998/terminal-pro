# Ruff configuration for MTT Backend
# Replaces: Black, isort, Flake8, pyupgrade, and more
# Docs: https://docs.astral.sh/ruff/

# Target Python version
target-version = "py311"

# Line length (same as Black default)
line-length = 88

# Exclude paths
exclude = [
    ".git",
    ".venv",
    "venv",
    "__pycache__",
    "migrations",
    "static",
    "media",
    ".pytest_cache",
]

[lint]
# Enable these rule sets
select = [
    "E",      # pycodestyle errors
    "W",      # pycodestyle warnings
    "F",      # Pyflakes
    "I",      # isort (import sorting)
    "B",      # flake8-bugbear (common bugs)
    "C4",     # flake8-comprehensions
    "UP",     # pyupgrade (modern Python syntax)
    "DJ",     # flake8-django
    "SIM",    # flake8-simplify
    "RUF",    # Ruff-specific rules
]

# Ignore specific rules
ignore = [
    "E501",   # Line too long (handled by formatter)
    "B008",   # Do not perform function calls in argument defaults (needed for DRF)
    "B904",   # Within except clause, raise from err (too strict for Django)
    "RUF012", # Mutable class attributes (common in Django models)
    "RUF001", # Ambiguous characters - project uses Russian strings intentionally
    "RUF002", # Ambiguous characters in docstrings
    "RUF003", # Ambiguous characters in comments
    "DJ001",  # null=True on CharField - acceptable for optional fields
    "UP007",  # Use X | Y for Union - keep compatibility with older type checkers
]

# Allow autofix for all enabled rules
fixable = ["ALL"]
unfixable = []

[lint.per-file-ignores]
# Tests can use assertions and have unused imports (fixtures)
"tests/**/*.py" = ["S101", "F401", "F811", "F841", "B007", "E402"]
# Settings files often have unused imports and star imports
"**/settings.py" = ["F401", "F403", "F405"]
"**/settings/**/*.py" = ["F401", "F403", "F405"]
# __init__.py files often have unused imports for re-exports
"**/__init__.py" = ["F401"]
# Management commands often have delayed imports
"**/management/commands/*.py" = ["E402"]
# Script files
"scripts*.py" = ["E402", "F841"]

[lint.isort]
# Django import ordering
known-first-party = ["apps", "terminal_app", "telegram_bot"]
known-third-party = ["django", "rest_framework", "celery"]
section-order = ["future", "standard-library", "third-party", "first-party", "local-folder"]

# Force single line imports for cleaner diffs
force-single-line = false
# Add line between import sections
lines-after-imports = 2

[format]
# Use double quotes (same as Black)
quote-style = "double"

# Indent with spaces
indent-style = "space"

# Unix line endings
line-ending = "lf"

# Format docstrings
docstring-code-format = true
